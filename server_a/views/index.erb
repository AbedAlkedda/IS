<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Crawled Data</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <style>
      header { background-color: #343a40; color: white; padding: 10px 0; }

      th { text-align: center; }

      td { vertical-align: middle !important; }

      .header-title { margin: 0;font-size: 30px;font-weight: bold;text-align: center; }

      .header-subtitle { margin: 0; font-size: 20px; text-align: center; }

      .table-container { height: 500px; overflow-y: scroll; }

      .form-group label {font-weight: bold;color: #343a40;margin-right: 10px; }

      .form-group input[type=range]::-webkit-slider-thumb {-webkit-appearance: none;appearance: none;width: 20px;height: 20px;background-color: #343a40;border-radius: 50%ursor: pointer; }

      .form-group input[type=range]::-moz-range-thumb {width: 20px;height: 20px;background-color: #343a40;border-radius: 50%;cursor: pointer; }

      .form-group input[type=range]::-ms-thumb {width: 20px;height: 20px;background-color: #343a40;border-radius: 50%;cursor: pointer; }

      /* Custom styles for table */
      .table-bordered {border-color: #ccc; }

      .table-bordered thead th {background-color: #f0f0f0;border-color: #ccc; }

      .table-bordered tbody td {background-color: #fff;border-color: #ccc; }

      .table-bordered tbody td a {color: #343a40;font-weight: bold; }

      .table-bordered tbody td a:hover {text-decoration: none;color: #343a40; }

      .text-center { text-align: center; }

      .htwk-info table { border-collapse: collapse;width: 100%; }

      .htwk-info th, .htwk-info td { text-align: left;padding: 8px; }

      .htwk-info tr:nth-child(even) { background-color: #f2f2f2; }

      .htwk-info th { background-color: #4CAF50;color: white; }

      .htwk-label { font-size: 24px;color: #333;text-align: center;margin-bottom: 20px; }
    </style>

    <script>
      $(document).ready(function() {
        var container = $('.js-data-wrapper');
          var   title     = [],
                year      = [],
                rating    = [],
                link      = [],
                thumbnail = [];

        $('.js-number-selector').on('change', function(e) {

            $('#num-label').text(e.target.value);
            // fetch data
            fetch('/update-list', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(e.target.value)
          })
          .then(response => response.json())
          .then(data => {
            // replace the childern of the children!
            // container.empty();
            data.forEach(function(item) {
              title.push(item.title);
              year.push(item.year);
              rating.push(item.rating);
              link.push(item.link);
              thumbnail.push(item.thumbnail);
            });
          })
          .catch(error => {
            console.error('Error:', error);
          });

          // add feteched data to container
          console.log('Add to container');

          // clear arrays
          console.log('clear arrays');

        });
      });
    </script>
  </head>
  <body>
    <header>
      <h1 class="header-title">Crawled Data</h1>
      <p class="header-subtitle">A list of movies scraped from the web</p>
    </header>
    <div class="container">
      <div class="row">
        <form class="form-inline text-center" action="/" method="get">
          <div class="form-group js-number-selector number-selector">
            <label for="num">Movies to display</label>
            <input type="range" min="0" max="100" class="form-control-range large-range" id="num" name="num">
            <span id="num-label">0</span>
          </div>
        </form>
      </div>
      <div class="table-container">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Thumbnail</th>
              <th>Title</th>
              <th>Year</th>
              <th>Rating</th>
              <th>Link</th>
            </tr>
          </thead>
          <tbody>
            <% @movies.each_with_index do |movie, index| %>
              <tr class="text-center js-data-wrapper">
                <td id="img-<%= index %>"><img src="<%= movie[:thumbnail] %>" alt="<%= movie[:title] %>" class="img-thumbnail"></td>
                <td id="title-<%= index %>"><%= movie[:title] %></td>
                <td id="year-<%= index %>"><%= movie[:year] %></td>
                <td id="rating-<%= index %>"><%= movie[:rating] %></td>
                <td id="link-<%= index %>"><%= "<a href='#{movie[:link]}' target='_blank'>#{movie[:link]}</a>" %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <div class="htwk-info">
        <h2 class="htwk-label">Wintersemester 2022/2023</h2>
        <table>
          <% @htwk_infos.each do |key, value| %>
            <tr>
              <td><%= key %></td>
              <td><%= value %></td>
            </tr>
          <% end %>
        </table>
      </div>
    </div>
  </body>
</html>
